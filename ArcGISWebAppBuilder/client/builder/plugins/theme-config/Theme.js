// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/_base/array dojo/Deferred dojo/promise/all dojo/request jimu/utils".split(" "),function(m,k,n,h,p,q,r,f){return m(null,{appConfig:void 0,currentStyleName:void 0,currentLayoutName:void 0,_manifest:void 0,constructor:function(a){this._manifest=a;this.domNodes={}},clear:function(){var a;this.appConfig=null;for(a=0;a<this._manifest.layouts.length;a++)if("appLayout"===this._manifest.layouts[a].name){this._manifest.layouts[a].domNode&&n.destroy(this._manifest.layouts[a].domNode);
this._manifest.layouts.splice(a,1);break}},loadLayouts:function(){var a=new p,b=[],c=h.filter(this._manifest.layouts,function(d){return"appLayout"!==d.name});h.forEach(c,function(d){b.push(r(this._manifest.url+d.uri,{handleAs:"json"}))},this);q(b).then(k.hitch(this,function(d){var g;h.forEach(c,function(e,l){e.layoutConfig=d[l];"default"===e.name?g=e.layoutConfig:(l=e.layoutConfig.layoutDefinition,e.layoutConfig=f.mixinAppConfigPosition(g,e.layoutConfig),e.layoutConfig.layoutDefinition=l);e.layoutConfig.mobileLayout&&
(e.layoutConfig.mobileLayout=f.mixinAppConfigPosition(e.layoutConfig,e.layoutConfig.mobileLayout),delete e.layoutConfig.mobileLayout.mobileLayout)},this);a.resolve()}),function(){a.reject()});return a},_processLayoutConfig:function(a,b){return f.mixinAppConfigPosition(a,b)},setAppConfig:function(a){this.appConfig=a},getName:function(){return this._manifest.name},getVersion:function(){return this._manifest.version},getLabel:function(){return this._manifest.label},getIcon:function(){return this._manifest.icon},
getLayouts:function(){return this._manifest.layouts},getStyles:function(){return this._manifest.styles},getUrl:function(){return this._manifest.url},getCurrentStyle:function(){return this.getStyleByName(this.currentStyleName)},getCurrentLayout:function(){return this.getLayoutByName(this.currentLayoutName)},changeCurrentStyle:function(a){this.currentStyleName=a},changeCurrentLayout:function(a){this.currentLayoutName=a},addLayout:function(a,b,c,d){var g,e=this.getLayouts();for(g=0;g<e.length;g++)if(e[g].name===
a)return null;a={description:"this is current app layout",name:a,label:d,layoutConfig:b,domClass:c};this._manifest.layouts.push(a);return a},getStyleByName:function(a){var b,c=null;for(b=0;b<this._manifest.styles.length;b++)if(this._manifest.styles[b].name===a){c=this._manifest.styles[b];break}return c},getLayoutByName:function(a){var b,c=null;for(b=0;b<this._manifest.layouts.length;b++)if(this._manifest.layouts[b].name===a){c=this._manifest.layouts[b];break}return c},getLayoutByAppConfig:function(a){var b,
c=null;for(b=0;b<this._manifest.layouts.length;b++)if(this.isAppUseLayout(a,this._manifest.layouts[b].layoutConfig)){c=this._manifest.layouts[b];break}return c},isAppUseLayout:function(a,b){a=k.clone(a);b=k.clone(b);a.map||(a.map={});b.map||(b.map=a.map);a.map.position||(a.map.position={left:0,top:0});b.map.position||(b.map.position=a.map.position);if(!f.isEqual(a.layoutDefinition,b.layoutDefinition)||!f.isEqual(a.map.position,b.map.position))return!1;a.widgetOnScreen||(a.widgetOnScreen={});b.widgetOnScreen||
(b.widgetOnScreen={});a.widgetOnScreen.widgets||(a.widgetOnScreen.widgets=[]);b.widgetOnScreen.widgets||(b.widgetOnScreen.widgets=[]);a.widgetOnScreen.groups||(a.widgetOnScreen.groups=[]);b.widgetOnScreen.groups||(b.widgetOnScreen.groups=[]);var c;var d=a.widgetOnScreen.widgets.length<b.widgetOnScreen.widgets.length?a.widgetOnScreen.widgets.length:b.widgetOnScreen.widgets.length;for(c=0;c<d;c++)if(a.widgetOnScreen.widgets[c].position||(a.widgetOnScreen.widgets[c].position={}),b.widgetOnScreen.widgets[c].position||
(b.widgetOnScreen.widgets[c].position=a.widgetOnScreen.widgets[c].position),b.widgetOnScreen.widgets[c].position.relativeTo||(b.widgetOnScreen.widgets[c].position.relativeTo=a.widgetOnScreen.widgets[c].position.relativeTo),!f.isEqual(a.widgetOnScreen.widgets[c].position,b.widgetOnScreen.widgets[c].position))return!1;d=a.widgetOnScreen.groups.length<b.widgetOnScreen.groups.length?a.widgetOnScreen.groups.length:b.widgetOnScreen.groups.length;for(c=0;c<d;c++)if(a.widgetOnScreen.groups[c].panel||(a.widgetOnScreen.groups[c].panel=
{}),b.widgetOnScreen.groups[c].panel||(b.widgetOnScreen.groups[c].panel=a.widgetOnScreen.groups[c].panel),a.widgetOnScreen.groups[c].panel.position||(a.widgetOnScreen.groups[c].panel.position={}),b.widgetOnScreen.groups[c].panel.position||(b.widgetOnScreen.groups[c].panel.position=a.widgetOnScreen.groups[c].panel.position),b.widgetOnScreen.groups[c].panel.position.relativeTo||(b.widgetOnScreen.groups[c].panel.position.relativeTo=a.widgetOnScreen.groups[c].panel.position.relativeTo),!f.isEqual(a.widgetOnScreen.groups[c].panel.position,
b.widgetOnScreen.groups[c].panel.position))return!1;return!0},getLayoutFromConfig:function(a){var b={};a=k.clone(a);a.widgetOnScreen&&(b.widgetOnScreen={},a.widgetOnScreen.widgets&&(b.widgetOnScreen.widgets=[],h.forEach(a.widgetOnScreen.widgets,function(c,d){b.widgetOnScreen.widgets[d]={position:c.position?c.position:{left:0,top:0}}})),a.widgetOnScreen.groups&&(b.widgetOnScreen.groups=[],h.forEach(a.widgetOnScreen.groups,function(c,d){b.widgetOnScreen.groups[d]={position:c.position?c.position:{left:0,
top:0}}})));a.map&&(b.map={position:a.map.position});return b}})});