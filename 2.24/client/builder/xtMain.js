// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"builder/SetPortalUrl":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/html dojo/topic dojox/validate/regexp dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/SetPortalUrl.html dojo/Evented dojo/request dojo/Deferred dojo/keys dojo/cookie dojo/store/Memory dojo/request/script jimu/dijit/LoadingIndicator jimu/portalUrlUtils ./tokenUtils esri/request esri/arcgis/OAuthInfo esri/IdentityManager dijit/form/TextBox dijit/form/ValidationTextBox jimu/dijit/URLComboBox".split(" "),
function(f,q,c,w,l,v,z,e,x,r,t,n,E,B,y,G,F,m,k,u,A,C){return q([r,v,z,e],{baseClass:"jimu-set-portal-url",templateString:x,label:"setportalurl",defaultExpires:20160,invalidInput:!0,_portalUrlInputStatus:"uncheck",_validPortalUrls:null,_UrlEnterKeyDown:!1,_continueClick:!1,_oauthCheckError:null,currentDef:null,signinInfo:null,currentPortalUrl:null,postMixInProperties:function(){this.nls=window.builderNls;this.jimuNls=window.jimuNls},postCreate:function(){this.inherited(arguments);this.signinInfos=
[];this._validPortalUrls=[];this.loading||(this.loading=new F);this.loading.placeAt(this.domNode);this.loading.show();this.loadingUrl=c.create("div",{"class":"loadingUrl"},this.portalUrlInput.domNode);this.invalidUrl=c.create("div",{"class":"invalidUrl"},this.portalUrlInput.domNode);this.validUrl=c.create("div",{"class":"validUrl"},this.portalUrlInput.domNode);this.signinInfo={portalUrl:"",supportsOAuth:!1,appId:null};c.addClass(this.portalUrlInput.domNode,"portalUrlInput");this._getFAQHelpLink().then(f.hitch(this,
function(a){c.setStyle(this.faqNode,"display","inline-block");c.setAttr(this.faqNode,"href",a)}));this.portalUrlInput.set("missingMessage",this.nls.missingMessage);this.portalUrlInput.set("invalidMessage",this.nls.invalidMessage);this._getSigninInfos().then(f.hitch(this,function(a){var b=new y({data:a});this.signinInfos=a;this.portalUrlInput.set("store",b);this.portalUrlInput.set("searchAttr","portalUrl");this.currentPortalUrl?this.portalUrlInput.set("value",this.currentPortalUrl):a[0]&&a[0].portalUrl&&
this.portalUrlInput.set("value",a[0].portalUrl)}),f.hitch(this,function(a){console.error(a)})).always(f.hitch(this,function(){this.loading.hide()}))},_writeWabCurrentPortalUrlToCookie:function(a){B("wab_portalurl",a,{path:"/webappbuilder"});B("wab_portalurl",a,{path:"/webappviewer"});B("wab_portalurl_persistent",a,{path:"/",expires:365})},_getFAQHelpLink:function(){var a=new n;window.isXT?t("/webappbuilder/help/exists",{handleAs:"json"}).then(f.hitch(this,function(b){b&&b.exists?t("/webappbuilder/help/cxhelp.js",
{handleAs:"json"}).then(f.hitch(this,function(d){var g="#";d&&d.m&&d.m["120000962"]&&(g="/webappbuilder/help/"+d.m["120000962"]);a.resolve(g)}),f.hitch(this,function(d){console.warn(d);a.resolve("#")})):a.resolve("#")}),function(b){console.log(b);a.resolve("#")}):a.resolve("#");return a},_getSigninInfos:function(){var a=new n;t("/webappbuilder/rest/signininfo/getsignininfos",{handleAs:"json"}).then(f.hitch(this,function(b){b.success?a.resolve(b.infos):a.resolve([])}),f.hitch(this,function(b){a.reject(b)}));
return a},setPortalUrl:function(a,b){this._oauthCheckError={portalUrl:a,error:b};this.currentPortalUrl=a;this.portalUrlInput.set("value",a)},_isValidAppIdInPortalUrl:function(a){return this._oauthCheckError?!m.isSamePortalUrl(a,this._oauthCheckError.portalUrl)||"invalid_client_id"!==this._oauthCheckError.error&&"invalid_redirect_uri"!==this._oauthCheckError.error?!0:!1:!0},_onPortalUrlKeyDown:function(a){(a.keyCode?a.keyCode:a.which)===E.ENTER?(this._UrlEnterKeyDown=!0,this.portalUrlInput.onBlur()):
(this._continueClick=this._UrlEnterKeyDown=!1,this._portalUrlInputStatus="uncheck",this._hideAllStatus(),c.setStyle(this.appIdDiv,"display","none"),this.appIdInput.set("value",""),this._cancelValidating())},_cancelValidating:function(){this.currentDef&&!this.currentDef.isCanceled()&&(this._portalUrlInputStatus="uncheck",this.currentDef.cancel(),c.setStyle(this.invalidUrl,"display","none"),c.setStyle(this.errorRemind,"display","none"))},_onPortalUrlBlur:function(){this._switchPortalUrlInputStatus()},
_switchPortalUrlInputStatus:function(){if("checking"!==this._portalUrlInputStatus){c.setStyle(this.appIdDiv,"display","none");var a=this.portalUrlInput.get("value");0>a.toLowerCase().indexOf("http://")&&0>a.toLowerCase().indexOf("https://")&&(a=m.setHttpProtocol(a));a=m.getStandardPortalUrl(a);if(this._isValidPortalUrl(a)){var b=this._getSigninInfo(a);b.portalUrl=a;this._showValidStatus();this.signinInfo=b;!b||!b.isWebTier&&b.supportsOAuth?b&&b.appId?(this.appIdInput.set("value",b.appId),this._UrlEnterKeyDown&&
this._onContinue()):(c.setStyle(this.appIdDiv,"display","block"),this._UrlEnterKeyDown=!1,this.appIdInput.set("value","")):this._UrlEnterKeyDown&&this._onContinue()}else this.appIdInput.set("value",""),this._UrlEnterKeyDown=!1,this._cancelValidating(),this._validatePortal()}},_isValidPortalUrl:function(a){for(var b=0,d=this._validPortalUrls.length;b<d;b++)if(m.isSamePortalUrl(a,this._validPortalUrls[b]))return!0;return!1},_onPortalUrlChange:function(){this._switchPortalUrlInputStatus()},_onAppIdInputKeyDown:function(a){(a.keyCode?
a.keyCode:a.which)===E.ENTER&&(this.signinInfo.appId=this.appIdInput.get("value"),this.continueBtn.focus(),this.continueBtn.click(),a.stopPropagation())},_onAppIdInputChange:function(){var a=this.signinInfo.appId,b=this.appIdInput.get("value");this.signinInfo.appId=b;this.signinInfo.supportsOAuth&&!this.signinInfo.appId?c.addClass(this.continueBtn,"Cont-btn-disable"):(c.removeClass(this.continueBtn,"Cont-btn-disable"),a!==b&&(c.removeClass(this.appIdInput.domNode,"errorStatus"),c.setStyle(this.appIdErrorNode,
"display","none")))},_updateSigninInfo:function(a){var b=new n;t("/webappbuilder/rest/signininfo/setsignininfo",{handleAs:"json",data:a,method:"POST"}).then(f.hitch(this,function(d){d.success&&this._writeWabCurrentPortalUrlToCookie(a.portalUrl);b.resolve(d)}),f.hitch(this,function(d){b.reject(d)}));return b},_allowNamedorLocal:function(a){var b="^"+l.url({allowNamed:!1,allowLocal:!1});return(new RegExp(b,"g")).test(a)},_validatePortalExist:function(a){var b=new n;a=m.getPortalSelfInfoUrl(a);a=m.setHttpsProtocol(a);
this.currentDef=G.get(a+"?f\x3djson",{handleAs:"json",jsonp:"callback",timeout:6E4});this.currentDef.then(f.hitch(this,function(d){b.resolve(d&&d.hasOwnProperty("portalName"))}),f.hitch(this,function(d){console.error(d);b.resolve(!1)}));return b},_validatePortal:function(){this.portalUrlInput.get("value")?c.setStyle(this.remind,"display","none"):c.setStyle(this.remind,"display","block");var a=this.portalUrlInput.get("value");a&&(this.portalUrlInput.validator(this.portalUrlInput.get("value"))&&(a=
this.portalUrlInput.get("value")),0>a.toLowerCase().indexOf("http://")&&0>a.toLowerCase().indexOf("https://")&&(a=m.setHttpProtocol(a)),/www.arcgis.com/gi.test(a)||!this._allowNamedorLocal(a)?this._showInvalidStatus():(this._showValidatingStatus(),a=m.getStandardPortalUrl(a),c.addClass(this.continueBtn,"Cont-btn-disable"),this._validatePortalExist(a).then(f.hitch(this,function(b){b?this._postProcessPortal(a):(this._showInvalidStatus(),c.setStyle(this.appIdDiv,"display","none"))}))))},_getPortalSelf:function(a){var b=
{url:a+"/sharing/rest/portals/self",content:{f:"json"},handleAs:"json",timeout:15E3,callbackParamName:"callback",preventCache:!0};if(a=k.getPortalCredential(a))a.token&&(b.content.token=a.token),a.ssl&&(b.url=m.setHttpsProtocol(b.url));return u(b)},_postProcessPortal:function(a){this.currentDef=k.isWebTierPortal(a);this.currentDef.then(f.hitch(this,function(b){var d=k.getPortalCredential(a);d&&(d.ssl&&(a=m.setHttpsProtocol(a)),w.publish("userSignIn",d));this.currentDef=d=this._getPortalSelf(a);this.signinInfo=
{portalUrl:a};d.then(f.hitch(this,function(g){this.portalSelfInfo=g;if(g.isPortal||g.urlKey){var h=this._getSigninInfo(a);h||this.signinInfos.push(this.signinInfo);this._isValidPortalUrl(a)||this._validPortalUrls.push(a);this.signinInfo.supportsOAuth=g.supportsOAuth;if(b)this.signinInfo.isWebTier=!0,this._showValidStatus(),c.removeClass(this.continueBtn,"Cont-btn-disable");else if(this.signinInfo.appId=h?h.appId:"",this.signinInfo.supportsOAuth?this.signinInfo.appId?(this._isValidAppIdInPortalUrl(a)||
(c.setStyle(this.appIdDiv,"display","block"),c.addClass(this.appIdInput.domNode,"errorStatus"),c.setStyle(this.appIdErrorNode,"display","block")),this.appIdInput.set("value",this.signinInfo.appId)):c.setStyle(this.appIdDiv,"display","block"):c.setStyle(this.appIdDiv,"display","none"),this._showValidStatus(),c.removeClass(this.continueBtn,"Cont-btn-disable"),g=c.getStyle(this.appIdDiv,"display"),this.signinInfo.supportsOAuth&&"none"!==g)c.addClass(this.continueBtn,"Cont-btn-disable"),this.appIdInput.focus();
else if(this._UrlEnterKeyDown||this._continueClick)this._onContinue(),this._UrlEnterKeyDown=this._continueClick=!1}else this._showInvalidStatus(),console.error("should input full qualified org name")}),f.hitch(this,function(g){this._showInvalidStatus();console.error(g)}))}),f.hitch(this,function(b){this._showInvalidStatus();console.error(b)}))},_getSigninInfo:function(a){for(var b=0;b<this.signinInfos.length;b++)if(m.isSamePortalUrl(this.signinInfos[b].portalUrl,a))return f.clone(this.signinInfos[b]);
return null},_hideAllStatus:function(){c.setStyle(this.loadingUrl,"display","none");c.setStyle(this.validUrl,"display","none");c.setStyle(this.invalidUrl,"display","none");c.setStyle(this.errorRemind,"display","none")},_showValidStatus:function(){c.removeClass(this.portalUrlInput.domNode,"errorStatus");c.setStyle(this.loadingUrl,"display","none");c.setStyle(this.validUrl,"display","block");c.setStyle(this.invalidUrl,"display","none");c.setStyle(this.errorRemind,"display","none");this.invalidInput=
!1;this._portalUrlInputStatus="checked"},_showValidatingStatus:function(){c.removeClass(this.portalUrlInput.domNode,"errorStatus");c.setStyle(this.loadingUrl,"display","block");c.setStyle(this.validUrl,"display","none");c.setStyle(this.invalidUrl,"display","none");c.setStyle(this.errorRemind,"display","none");this.invalidInput=!0;this._portalUrlInputStatus="checking"},_showInvalidStatus:function(){c.addClass(this.portalUrlInput.domNode,"errorStatus");c.setStyle(this.portalUrlInput.domNode,"data-dojo-props",
"missingMessage:'IPUT URL'");c.setStyle(this.loadingUrl,"display","none");c.setStyle(this.validUrl,"display","none");c.setStyle(this.invalidUrl,"display","block");c.setStyle(this.errorRemind,"display","block");var a=this.portalUrlInput.get("value");/www.arcgis.com/gi.test(a)||!this._allowNamedorLocal(a)?this.errorRemind.innerHTML=this.nls.errOrg+"\x3cbr\x3ehttps://myorg.maps.arcgis.com\x3cbr\x3ehttps://myportal.company.com/arcgis":this.errorRemind.innerHTML=this.nls.errPrefix+a+"\x3cbr\x3e"+this.nls.errRemind;
this.invalidInput=!0;this._portalUrlInputStatus="checked"},_onContinue:function(){this.invalidInput||(this.signinInfo.isWebTier?w.publish("switchToMainPage",this.signinInfo):this.signinInfo.supportsOAuth?this.signinInfo.appId?this._updateSigninInfo(this.signinInfo).then(f.hitch(this,function(a){a.success&&this._oauthSignIn(this.signinInfo.portalUrl,this.signinInfo.appId)})):this.appIdInput.focus():(this._continueClick=this._UrlEnterKeyDown=!1,w.publish("switchToSignin",f.clone(this.signinInfo))))},
_oauthSignIn:function(a,b){a=m.getStandardPortalUrl(a);b=new A({appId:b,portalUrl:a,expiration:this.defaultExpires,authNamespace:"/",popup:!1,flowType:"implicit",locale:window.dojoConfig.locale});C.registerOAuthInfos([b]);a=m.getSharingUrl(a);C.getCredential(a)}})})},"jimu/dijit/URLComboBox":function(){define(["dojo/_base/declare","dojo/_base/html","dijit/form/ComboBox","dojox/validate/regexp"],function(f,q,c,w){return f([c],{required:!0,invalidMessage:"Invalid url.",trim:!0,rest:!0,allowNamed:!1,
allowLocal:!1,declaredClass:"jimu.dijit.URLComboBox",postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.urlInput;this.invalidMessage=this.nls.invalidUrl},postCreate:function(){this.inherited(arguments);q.addClass(this.domNode,"jimu-url-combobox")},validator:function(l){if(isFinite(l))return!1;var v="^"+w.url({allowNamed:this.allowNamed,allowLocal:this.allowLocal});v=(new RegExp(v,"g")).test(l);return this.rest?(l=/\/rest\/services/gi.test(l),v&&l):v}})})},"builder/PortalSignIn":function(){define("dojo/_base/declare dojo/_base/lang dojo/on dojo/topic dojo/_base/html dojo/request/registry dojo/keys dojo/Deferred dojo/promise/all dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/PortalSignIn.html esri/request jimu/portalUrlUtils jimu/dijit/CheckBox jimu/dijit/Message ./tokenUtils".split(" "),
function(f,q,c,w,l,v,z,e,x,r,t,n,E,B,y,G,F,m){return f([r,t,n],{templateString:E,nls:null,defaultExpires:20160,label:"signin",postMixInProperties:function(){this.inherited(arguments);this.nls=window.builderNls},postCreate:function(){this.inherited(arguments);this._hideAppIdTip();this._bindEvents()},_hideAppIdTip:function(){l.setStyle(this.appIdTipSection,"display","none")},_bindEvents:function(){this.remember=new G({label:this.nls.remember,checked:!1},this.remember);this.own(c(this.password,"blur",
q.hitch(this,this.changeSigninStatus)));this.own(c(this.domNode,"keydown",q.hitch(this,function(k){(k.keyCode?k.keyCode:k.which)===z.ENTER&&this._onSigninClick()})))},_generateTokenSignIn:function(k){var u=new e,A=m.xtGetCredentialFromCookie(k);if(A)return u.resolve(A),u;m.removeWabAuthInfo();k=y.getStandardPortalUrl(k);var C=y.setHttpsProtocol(k);A="/proxy.js?"+C+"/sharing/rest/generateToken";this.shelter.show(this.nls.signingIn+"...");v(A,{handleAs:"json",method:"POST",data:{request:"getToken",
username:l.getAttr(this.username,"value"),password:l.getAttr(this.password,"value"),referer:window.location.host,expiration:this.remember.checked?this.defaultExpires:120,f:"json"},headers:{"X-Requested-With":null}}).then(q.hitch(this,function(a){if(a&&a.token){this._clearUserPassword();var b="/proxy.js?"+y.getCommunitySelfUrl(C),d=this._getPortalSelf(a.token);b=v(b,{handleAs:"json",method:"POST",data:{token:a.token,f:"json"},headers:{"X-Requested-With":null}});x([d,b]).then(q.hitch(this,function(g){this.shelter.hide();
var h=g[0];g=g[1];if(g.orgId){var p=y.getProtocol(k)+":";!h.isPortal&&h.urlKey&&(this.signinInfo.portalUrl=p+"//"+h.urlKey.toLowerCase()+"."+h.customBaseUrl);g.username&&(h={server:y.getStandardPortalUrl(this.signinInfo.portalUrl),token:a.token,userId:g.username,expires:a.expires,referer:window.location.host,scope:"portal",isAdmin:"org_admin"===g.role},g=m.saveAndRegisterCookieToCredential(h),w.publish("userSignIn",g),u.resolve(h))}else new F({message:this.nls.namedUserTip,container:document.body})}),
q.hitch(this,function(g){console.error(g);this._loginStatus(!0);u.reject(g)}))}else this.shelter.hide(),this._loginStatus(!0),u.reject()}),q.hitch(this,function(a){this.shelter.hide();console.error(a);this._loginStatus(!0);u.reject(a)}));return u},setSigninInfo:function(k){this.signinInfo=k;l.setStyle(this.domNode,"display","block");var u=y.getStandardPortalUrl(k.portalUrl);this.forgot.href=u+"/home/troubleshoot.html";m.xtGetCredentialFromCookie(k.portalUrl)&&this._onSigninClick()},_getPortalSelf:function(k){var u=
{url:y.getPortalSelfInfoUrl(this.signinInfo.portalUrl),content:{f:"json"},handleAs:"json",callbackParamName:"callback",preventCache:!0};k&&(u.content.token=k);return B(u)},_onSigninClick:function(){this._generateTokenSignIn(this.signinInfo.portalUrl).then(q.hitch(this,function(){w.publish("switchToMainPage",this.signinInfo)}),q.hitch(this,function(k){console.error(k)}))},_onBackClick:function(){w.publish("switchToSetPortalUrl")},_loginStatus:function(k){k?(this.username.focus(),l.setStyle(this.errorNode,
"display","block")):l.setStyle(this.errorNode,"display","none")},_clearUserPassword:function(){this.username.value="";this.password.value=""},changeSigninStatus:function(){this.password.value?l.removeClass(this.signin,"signin-btn-disable"):l.hasClass(this.signin,"signin-btn-disable")||l.addClass(this.signin,"signin-btn-disable")}})})},"dojo/request/registry":function(){define(["require","../_base/array","./default!platform","./util"],function(f,q,c,w){function l(e,x){for(var r=z.slice(0),t=0,n;n=
r[t++];)if(n(e,x))return n.request.apply(null,arguments);return c.apply(null,arguments)}function v(e,x){if(x){var r=e.test?function(t){return e.test(t)}:e.apply&&e.call?function(){return e.apply(null,arguments)}:function(t){return t===e};r.request=x}else r=function(){return!0},r.request=e;return r}var z=[];l.register=function(e,x,r){var t=v(e,x);z[r?"unshift":"push"](t);return{remove:function(){var n;~(n=q.indexOf(z,t))&&z.splice(n,1)}}};l.load=function(e,x,r,t){e?f([e],function(n){c=n;r(l)}):r(l)};
w.addCommonMethods(l);return l})},"url:builder/templates/SetPortalUrl.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"content" data-dojo-attach-point\x3d"portalContent"\x3e\r\n    \x3cp class \x3d "specify-text-url"\x3e${nls.tip}\x3c/p\x3e\r\n\r\n    \x3cdiv class\x3d"portalUrlDiv" id\x3d"portalUrlDiv"\x3e\r\n      \x3cinput class\x3d"portalUrlInput" data-dojo-attach-point\x3d"portalUrlInput" name\x3d"portalUrl" type\x3d"text"\r\n      data-dojo-type\x3d"jimu/dijit/URLComboBox" data-dojo-attach-event\x3d"KeyDown: _onPortalUrlKeyDown,Change:_onPortalUrlChange,Blur:_onPortalUrlBlur" data-dojo-props\x3d"rest:false, allowNamed:true, allowLocal:true" /\x3e\r\n      \x3cdiv class\x3d"Remind" data-dojo-attach-point\x3d"remind" \x3e\r\n        \x3ctable\x3e\r\n          \x3ctr\x3e\r\n            \x3ctd\x3e${nls.example}:\x3c/td\x3e\x3ctd\x3ehttps://myportal.company.com/arcgis\x3c/td\x3e\r\n          \x3c/tr\x3e\r\n          \x3ctr\x3e\r\n            \x3ctd\x3e\x3c/td\x3e\x3ctd\x3ehttps://orgname.maps.arcgis.com\x3c/td\x3e\r\n          \x3c/tr\x3e\r\n        \x3c/table\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"errorRemind" data-dojo-attach-point\x3d"errorRemind"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"appIdDiv" data-dojo-attach-point\x3d"appIdDiv"\x3e\r\n      \x3cp\x3e\r\n        \x3cspan\x3e\r\n          ${nls.appIdTip}\r\n        \x3c/span\x3e\r\n        \x3cspan\x3e(\x3c/span\x3e\r\n        \x3ca href\x3d"//developers.arcgis.com/web-appbuilder/guide/getstarted.htm#ESRI_SECTION1_F2CE6567CB854E4AB43F08EB64B3D7AE" target\x3d"_blank"\x3e${jimuNls.common.help}\x3c/a\x3e\r\n        \x3cspan\x3e)\x3c/span\x3e\r\n      \x3c/p\x3e\r\n      \x3cinput type\x3d"text" class\x3d"appIdInput" data-dojo-attach-point\x3d"appIdInput" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-attach-event\x3d"Change: _onAppIdInputChange,KeyDown: _onAppIdInputKeyDown"\r\n      data-dojo-props\x3d\'required:true,placeHolder:"${nls.appIdPlaceHolder}"\'/\x3e\r\n      \x3clabel class\x3d"appIdError jimu-float-leading" data-dojo-attach-point\x3d"appIdErrorNode"\x3e${nls.appIdError}\x3c/label\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"ContinueBtn jimu-float-trailing" data-dojo-attach-point\x3d"continueBtn" data-dojo-attach-event\x3d"click:_onContinue"\x3e\r\n      ${nls.continueBtn}\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"trouble-shooting"\x3e\r\n      \x3ca data-dojo-attach-point\x3d"faqNode" target\x3d"_blank"\x3e${nls.faq}\x3c/a\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:builder/templates/PortalSignIn.html":'\x3cdiv class\x3d"jimu-portal-signin"\x3e\r\n  \x3clabel data-dojo-attach-point\x3d"errorNode" class\x3d"error-message"\x3e${nls.errorMessage}\x3c/label\x3e\r\n  \x3cdiv class\x3d"signin-content" data-dojo-attach-point\x3d"signinContentNode"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"appIdTipSection" class\x3d"appid-tip-section" style\x3d"display:none;"\x3e\r\n      \x3cdiv\x3e${nls.appIdTip1}\x3c/div\x3e\r\n      \x3cdiv style\x3d"margin-top:20px;"\x3e\r\n        \x3cspan\x3e${nls.appIdTip2}\x3c/span\x3e\r\n        \x3ca class\x3dhelp-link target\x3d_blank href\x3d"http://doc.arcgis.com/en/arcgis-online/share-maps/add-items.htm#ESRI_SECTION2_20AF85308FD548B5ADBAE28836F66D3F"\x3e${nls.here}\x3c/a\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"form"\x3e\r\n      \x3clabel\x3e${nls.username}\x3c/label\x3e\r\n      \x3cinput type\x3d"text" tabindex\x3d"1" data-dojo-attach-point\x3d"username" /\x3e\r\n      \x3clabel\x3e${nls.password}\x3c/label\x3e\r\n      \x3ca data-dojo-attach-point\x3d"forgot" style\x3d"margin-left:10px;" target\x3d"_blank" href\x3d"#"\x3e${nls.forgot}\x3c/a\x3e\r\n      \x3cinput type\x3d"password" tabindex\x3d"2" data-dojo-attach-point\x3d"password" /\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"remember"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"operations"\x3e\r\n      \x3cdiv class\x3d"btn signin-btn jimu-float-trailing" data-dojo-attach-point\x3d"signin" tabindex\x3d"3" data-dojo-attach-event\x3d"onclick:_onSigninClick" \x3e${nls.con}\x3c/div\x3e\r\n      \x3cdiv class\x3d"btn jimu-trailing-margin2 jimu-float-trailing" data-dojo-attach-point\x3d"btnBack" data-dojo-attach-event\x3d"onclick:_onBackClick"\x3e${nls.back}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d"hidden:true"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/parser dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/cookie dojo/request/xhr dojo/topic dijit/registry builder/tokenUtils jimu jimu/utils jimu/portalUrlUtils jimu/portalUtils jimu/dijit/ViewStack jimu/dijit/LoadingShelter ./SetPortalUrl ./PortalSignIn ./utils esri/config esri/urlUtils esri/request esri/IdentityManager".split(" "),function(f,q,c,w,l,v,z,e,x,r,t,n,E,B,y,G,F,m,k,u,A,C,a){function b(h){q.setStyle("pre-main-page","display","block");q.setStyle("main-page","display",
"none");null===d&&(d=new y({viewType:"dijit",views:[new F({},"portal-url-div"),new m({},"signin-div")]},"pre-main-page"),d.switchView("setportalurl"))}var d=null;e.subscribe("switchToSetPortalUrl",function(){b();d.switchView("setportalurl")});e.subscribe("switchToSignin",function(h){b();var p=window.location.href.replace("action\x3dsetportalurl","action\x3dsignin");n.changeLocation(p);d.switchView("signin");d.getViewByLabel("signin").setSigninInfo(h)});a._oAuthDfd=null;var g=v("wab_portalurl_persistent");
(function(){u.defaults.io.proxyUrl="/proxy.js";z("/webappbuilder/rest/signininfo/getsignininfo",{query:{portalUrl:g},handleAs:"json"}).then(function(h){if(h.success)if(h=h.info){var p=window.originalHash.replace("#","");p=n.hashToObject(p);if(p.access_token){var D=k.removeActionFromUrl(window.location.href);n.changeLocation(D);p.state||(p.state={portalUrl:g});p=r.registerAuth2Hash(p);e.publish("userSignIn",p);e.publish("switchToMainPage",h)}else p.error&&p.error_description?(D="unknown_error","invalid_request"===
p.error?"Invalid client_id"===p.error_description?D="invalid_client_id":"Invalid redirect_uri"===p.error_description&&(D="invalid_redirect_uri"):D="access_denied"===p.error?"access_denied":"unknown_error",e.publish("switchToSetPortalUrl"),d.getViewByLabel("setportalurl").setPortalUrl(h.portalUrl,D)):"setportalurl"===queryObject.action?(e.publish("switchToSetPortalUrl"),d.getViewByLabel("setportalurl").setPortalUrl(h.portalUrl)):"signin"===queryObject.action?h.supportsOAuth||h.isWebTier?(e.publish("switchToSetPortalUrl"),
d.getViewByLabel("setportalurl").setPortalUrl(h.portalUrl)):e.publish("switchToSignin",h):h.isWebTier?(e.publish("switchToSetPortalUrl"),d.getViewByLabel("setportalurl").setPortalUrl(h.portalUrl)):e.publish("switchToMainPage",h)}else e.publish("switchToSetPortalUrl"),d.getViewByLabel("setportalurl").setPortalUrl(g);else console.log("Unknow error")})})()});