// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:builder/plugins/widget-config/WidgetSettingPage.html":'\x3cdiv class\x3d"widget-setting-page"\x3e\r\n  \x3cdiv class\x3d"section common-setting" data-dojo-attach-point\x3d"commonSettingNode"\x3e\r\n    \x3cdiv class\x3d"basic"\x3e\r\n      \x3cdiv class\x3d"icon jimu-float-leading"\x3e\r\n        \x3cimg class\x3d"real-icon"  data-dojo-attach-point\x3d"iconNode"\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"right jimu-float-trailing jimu-leading-margin1"\x3e\r\n        \x3cinput data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-attach-point\x3d"labelNode" placeholder\x3d"${nls.widgetLabel}" required\x3d"true" class\x3d"widget-setting-input" tabindex\x3d"0"\x3e\r\n        \x3cdiv class\x3d"right-foot" data-dojo-attach-point\x3d"rightFooterNode"\x3e\r\n          \x3cdiv class\x3d"image-container"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"imageChooserPlaceholder"\x3e\x3c/div\x3e\r\n            \x3c!-- \x3cspan nowrap class\x3d"change-icon" data-dojo-attach-point\x3d"changeNode"\x3e${nls.changeIcon}\x3c/span\x3e --\x3e\r\n            \x3ca class\x3d"help-link" target\x3d"_blank" data-dojo-attach-point\x3d"helpNode"\x3e${nls.more}\x3c/a\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"layout"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"section widget-setting" data-dojo-attach-point\x3d"widgetSettingNode"\x3e\x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/config dojo/Deferred dojo/request dojo/topic dojo/aspect dojo/on dojo/mouse dojo/query dojo/string dojo/NodeList-dom dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./WidgetSettingPage.html ./WidgetDefaultSettingPage jimu/utils jimu/WidgetManager jimu/portalUrlUtils jimu/portalUtils jimu/dijit/ViewStack jimu/dijit/ImageChooser jimu/dijit/LoadingIndicator jimu/dijit/Message dijit/form/CheckBox esri/request".split(" "),
function(y,d,h,M,u,z,m,A,N,v,O,P,B,Q,C,D,E,F,G,q,w,r,H,R,n,I,J,S,K){var t="en de es fr ja ru zh-cn zh-tw zh-hk ar it ko pl pt-br pt-pt ro".split(" "),L=[],p=null;return y([C,D,E],{templateString:F,startup:function(){this.inherited(arguments);this.own(m("builder/widgethelp.json",{handleAs:"json"}).then(function(a){p=a},function(a){console.error(a)}).always(d.hitch(this,function(){this.domNode&&(this.own(v(window,"resize",d.hitch(this,this.resize))),this.init())})))},init:function(){this.loading=new I;
h.addClass(this.loading.domNode,"load-widget-setting");this.loading.placeAt(this.widgetSettingNode);this.initCommonAttr();this.initWidgetAttr();this.resize()},resize:function(){var a=h.getContentBox(this.domNode);h.setStyle(this.widgetSettingNode,{height:a.h-94+"px"})},onCancel:function(){this.onClose();this.popup.close()},onOk:function(){var a=this._checkLabelExist();if(a)return new J({message:a}),!1;this.imageChooser.imageData&&(this.setting.icon=this.imageChooser.imageData);this.setting.label=
q.sanitizeHTML(this.labelNode.get("value"));if(this.settingDijit){var b=this.settingDijit.getConfig(!0);if(!1===b)return!1;b&&"function"===typeof b.then?b.then(d.hitch(this,function(e){if(!1===e)return!1;var c=this.settingDijit.getDataSources();c&&"function"===typeof c.then?c.then(d.hitch(this,function(l){this.setting.config=e;this.setting.provideDataSources=l;this._closeSettingPopup()})):(this.setting.config=e,this.setting.provideDataSources=c,this._closeSettingPopup())})):(a=this.settingDijit.getDataSources())&&
"function"===typeof a.then?a.then(d.hitch(this,function(e){this.setting.config=b;this.setting.provideDataSources=e;this._closeSettingPopup()})):(this.setting.config=b,this.setting.provideDataSources=a,this._closeSettingPopup())}else this._closeSettingPopup()},_closeSettingPopup:function(){delete this.setting.isDefaultConfig;A.publish("widgetSettingPageOk",this.setting,this.fromNode);this.onClose();this.popup.close()},_checkLabelExist:function(){var a=0,b=this.labelNode.get("value");if(""===B.trim(b))return this.nls.labelRequired;
var e=q.getControllerWidgets(this.appConfig);this.appConfig.visitElement(d.hitch(this,function(c){this.setting.id!==c.id&&c.label===b&&(0<e.length?a++:c.isOnScreen&&a++)}));return 0<a?this.nls.labelExists:""},onClose:function(){this.popup&&this.popup.closeBtnNode&&this.popup.closeBtnNode.focus();this.settingViewStack?(this.settingDijitUI.destroy(),this.settingDijitJSON.destroy(),this.settingViewStack.destroy()):this.settingDijit&&this.settingDijit.destroy()},_isInSupportLanguages:function(){var a=
!1,b=u.locale.toLowerCase();if(-1<t.indexOf(b))a=!0;else for(var e=0;e<t.length;e++)if(b.split("-")[0]===t[e].split("-")[0]){a=!0;break}return a},_getHelpLink:function(a,b){var e=new z,c=null;a=a.toLowerCase();b="html"===(b||"html").toLowerCase()?"widgets2d":"widgets3d";if(window.isXT)m("/webappbuilder/help/exists",{handleAs:"json"}).then(d.hitch(this,function(f){f&&f.exists?m("/webappbuilder/help/cxhelp.js",{handleAs:"json"}).then(d.hitch(this,function(g){var k="#";c=d.getObject("dev."+b+"."+a,!1,
p);g&&g.m&&c&&g.m[c]?k="/webappbuilder/help/"+g.m[c]:c&&(k="/webappbuilder/help/"+c);e.resolve(k)}),d.hitch(this,function(g){console.warn(g);e.resolve("#")})):e.resolve("#")}),function(f){console.error(f);e.resolve("#")});else{var l=r.getPortalUrlFromLocation();if(-1<l.indexOf("arcgis.com")){var x="#";c=d.getObject("online."+b+"."+a,!1,p);"widgets3d"===b||-1<L.indexOf(a)||!this._isInSupportLanguages()?(c&&(x="http://"+(-1<l.indexOf("maps.arcgis.com")?"doc":"docdev")+".arcgis.com/en/web-appbuilder/create-apps/"+
c),e.resolve(x)):(l={url:r.getPortalSelfInfoUrl(l),content:{f:"json",culture:u.locale},handleAs:"json",callbackParamName:"callback",preventCache:!0},K(l).then(d.hitch(this,function(f){var g="#";if(f&&f.helpBase&&c)try{g=f.helpBase.split("/").slice(0,4).join("/")+"/web-appbuilder/create-apps/"+c}catch(k){g="http://doc.arcgis.com/en/web-appbuilder/create-apps/"+c}e.resolve(g)}),d.hitch(this,function(f){console.warn(f);e.resolve("#")})))}else c=d.getObject("portal."+b+"."+a,!1,p),m(l+"sharing/rest/portals/helpmap?f\x3djson",
{handleAs:"json"}).then(d.hitch(this,function(f){var g="#";f&&f.helpMap&&f.helpMap.m&&c&&f.helpMap.m[c]&&H.getPortal(window.portalUrl).loadSelfInfo().then(d.hitch(this,function(k){k=k.helpBase;g=-1<k.indexOf("https:")?k+f.helpMap.m[c]:r.getPortalServerFromLocation()+k+f.helpMap.m[c];e.resolve(g)}))}),d.hitch(this,function(f){console.warn(f);e.resolve("#")}))}return e},initCommonAttr:function(){var a=q.processUrlInAppConfig(this.setting.icon);h.setAttr(this.iconNode,"src",a);window.isRTL&&this.setting.mirrorIconForRTL&&
h.addClass(this.iconNode,"jimu-flipx");this.labelNode.set("value",this.setting.label);this._getHelpLink(this.setting.name,d.getObject("manifest.platform",!1,this.setting)).then(d.hitch(this,function(b){"#"!==b&&(h.setStyle(this.helpNode,"display","block"),h.setAttr(this.helpNode,"href",b))}));this.imageChooser=new n({goldenWidth:24,goldenHeight:24,format:[n.GIF,n.JPEG,n.PNG],label:this.nls.changeIcon},this.imageChooserPlaceholder);!1===this.setting.inPanel&&!0===this.setting.isOnScreen&&!0!==this.setting.closeable?
(this.imageChooser.disableChooseImage(),h.setAttr(this.imageChooser.domNode,"title",this.nls.unableChangeIcon)):(this.imageChooser.enableChooseImage(),this.own(v(this.imageChooser,"imageChange",d.hitch(this,function(b){this.iconNode.src=b;this.setting.icon=b}))))},initWidgetAttr:function(){!1===this.setting.hasConfig?this.widgetSettingNode.innerHTML='\x3cdiv class\x3d"noconfig-info"\x3e'+this.nls.noConfig+"\x3c/div\x3e":w.getInstance().tryLoadWidgetConfig(this.setting).then(d.hitch(this,function(a){this.setting.hasSettingPage?
w.getInstance().loadWidgetSettingPage(this.setting).then(d.hitch(this,function(b){this.widgetSettingNode?(this.settingDijit=b,this.settingDijit.settingPagePopup=this.popup,h.place(this.settingDijit.domNode,this.widgetSettingNode),this.settingDijit.startup(),this.loading.destroy(),h.setAttr(this.widgetSettingNode,"data-widget-loaded","true")):b.destroy()})):this.widgetSettingNode&&(this.settingDijit=new G({config:this.setting.config}),h.place(this.settingDijit.domNode,this.widgetSettingNode),this.settingDijit.settingPagePopup=
this.popup,this.settingDijit.startup(),this.loading.destroy())}))},setAppConfig:function(a){this.appConfig=a}})});