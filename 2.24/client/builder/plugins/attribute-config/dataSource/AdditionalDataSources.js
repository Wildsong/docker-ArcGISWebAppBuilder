// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:builder/plugins/attribute-config/dataSource/AdditionalDataSources.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"ds-header"\x3e\r\n    \x3cspan class\x3d"ds-title ds-title-box textOverFlow" title\x3d"${nls.dataSource}"\x3e${nls.dataSource}\x3c/span\x3e\r\n    \x3cdiv class\x3d"dataSource-add-box dataSource-add margin-right-10" data-dojo-attach-point\x3d"addNewDs" data-dojo-attach-event\x3d"click:_onAddNewClick" title\x3d"${nls.addNew}"\x3e\r\n      \x3cdiv class\x3d"img_add"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"text_add textOverFlow" title\x3d"${nls.addNew}"\x3e${nls.addNew}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"dsOptions" class\x3d"ds-suspension ds-options ds-options-lr jimu-float-trailing hide"\x3e\r\n    \x3cdiv nowrap class\x3d"option-item textOverFlow" data-dojo-attach-point\x3d"btnAddLayer" data-dojo-attach-event\x3d"click:_onAddNewLayerClick" title\x3d"${nls.layer}"\x3e${nls.layer}\x3c/div\x3e\r\n    \x3cdiv nowrap class\x3d"option-item textOverFlow" data-dojo-attach-point\x3d"btnAddStatistics" data-dojo-attach-event\x3d"click:_onAddNewStatisticsClick" title\x3d"${nls.statistics}"\x3e${nls.statistics}\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d\'tabelHeader\'\x3e\r\n    \x3cdiv class\x3d"table-header"\x3e\r\n      \x3cdiv class\x3d"textOverFlow" title\x3d"${nls.name}"\x3e${nls.name}\x3c/div\x3e\r\n      \x3cdiv class\x3d"textOverFlow" title\x3d"${nls.type}"\x3e${nls.type}\x3c/div\x3e\r\n      \x3cdiv\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"horizontial-line"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"no-data-source-tip no-data-source-tip-box" data-dojo-attach-point\x3d"noDataSourceTip"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"sourcesList" data-dojo-attach-point\x3d"sourcesList"\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv style\x3d"margin-top: 30px;" data-dojo-attach-point\x3d"refreshIntervalDiv"\x3e\r\n  \x3c/div\x3e\r\n  \r\n\x3c/div\x3e'}});
define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./AdditionalDataSources.html dojo/on dojo/mouse dojo/query dojo/topic dojo/_base/lang dojo/_base/html jimu/dijit/_QueryableLayerSourcePopup jimu/dijit/Message jimu/utils ./DataSourceConfigPopup ./utils builder/dijit/RefreshInterval dijit/form/Select dijit/form/ValidationTextBox".split(" "),function(t,u,v,w,x,g,m,h,n,e,c,y,p,z,A,B,C){var q=m.enter,r=m.leave;return t([u,v,w],{templateString:x,
baseClass:"additional-data-sources",_layerId:"",_serviceType:"",_targetSourceId:"",layerType:"Features",_sourceType:"",postMixInProperties:function(){this.nls=e.mixin(this.nls,window.jimuNls.common,window.builderNls)},postCreate:function(){this.inherited(arguments);this._initRefreshInterval();this._renderUIByConfig();this._initEvent();this.own(n.subscribe("app/appConfigChanged",e.hitch(this,this._onAppConfigChanged)))},setMap:function(a){a&&(this.map=a)},_onAppConfigChanged:function(a){var b=z.isEqual(this.appConfig.dataSource,
a.dataSource);this.appConfig&&!b&&(this.appConfig=a,c.empty(this.sourcesList),this._renderUIByConfig())},_initRefreshInterval:function(){this.refreshIntervalDijit=new C({defaultRefreshTip:this.nls.defaultRefreshTip_dataSource,singleRefreshTip:this.nls.singleRefreshTip_dataSource});this.refreshIntervalDijit.placeAt(this.refreshIntervalDiv)},_renderUIByConfig:function(){var a=e.clone(this.appConfig.dataSource),b=a.dataSources,d;for(d in b)"widget"!==d.split("~")[0]&&this._addSourceTr(b[d]);a=a.settings||
{};b={};"undefined"!==typeof a.unifiedRefreshInterval?(b.useWebMapRefreshInterval=!1,b.minutes=a.unifiedRefreshInterval):b.useWebMapRefreshInterval=!0;this.refreshIntervalDijit.setValue(b);this._isNotEmptySourceList()?(c.setStyle(this.refreshIntervalDiv,"display",""),c.setStyle(this.tabelHeader,"display",""),c.setStyle(this.noDataSourceTip,"display","none")):(c.setStyle(this.refreshIntervalDiv,"display","none"),c.setStyle(this.tabelHeader,"display","none"),c.setStyle(this.noDataSourceTip,"display",
""))},_onAddNewClick:function(a){a.stopPropagation();c.hasClass(this.dsOptions,"hide")?this._showDsOption():this._hiddenDsOption()},_showDsOption:function(){c.removeClass(this.dsOptions,"hide")},_hiddenDsOption:function(){c.addClass(this.dsOptions,"hide")},_onAddNewLayerClick:function(a){a.stopPropagation();this._sourceType="Features";this._addNewSource()},_onAddNewStatisticsClick:function(a){a.stopPropagation();this._sourceType="FeatureStatistics";this._addNewSource()},_addNewSource:function(){this._hiddenDsOption();
var a=new y({titleLabel:this.nls.setDataSource,dijitArgs:{multiple:!1,createMapResponse:this.map.webMapResponse,mustSupportStatistics:"FeatureStatistics"===this._sourceType,portalUrl:this.appConfig.portalUrl,style:{height:"100%"}}});this.own(g(a,"ok",e.hitch(this,function(b){"FeatureStatistics"!==this._sourceType||this._isSupportStatistics(b.definition)?(this._setLayerId(b),b.label=b.name,this._serviceType=a.getSelectedRadioType(),a.close(),a=null,this._createSourceConfigPopup(b,"add")):new p({message:this.nls.notSupportStatistics})})));
this.own(g(a,"cancel",e.hitch(this,function(){a.close();a=null})))},_createSourceConfigPopup:function(a,b){e.mixin(a,{type:this._sourceType,serviceType:this._serviceType});this.sourceConfigPopup=new A({titleLabel:this.nls.configDataSource,dijitArgs:{nls:this.nls,map:this.map,config:a}});this.own(g(this.sourceConfigPopup,"ok",e.hitch(this,function(d){this.sourceConfigPopup.close();this.sourceConfigPopup=null;"add"===b?this._addDataSourceToAppConfig(d):this._updateDataSourceOfAppConfig(d)})));this.own(g(this.sourceConfigPopup,
"cancel",e.hitch(this,function(){this.sourceConfigPopup.close();this.sourceConfigPopup=null})))},_addDataSourceToAppConfig:function(a){a.id=this._generateSourceId();var b=e.clone(this.appConfig.dataSource);b.dataSources||(b.dataSources={});b.dataSources[a.id]=a;this._updateAppConfig(b)},_addSourceTr:function(a){this._sourceType=a.type;if("Features"===this._sourceType)var b=this.nls.layer;else"FeatureStatistics"===this._sourceType&&(b=this.nls.statistics);b='\x3cdiv style\x3d"width: 100%;"\x3e\x3cdiv class\x3d"source-tr"\x3e\x3cdiv class\x3d"source-td source-tr-name textOverFlow" title\x3d"'+
a.label+'"\x3e'+a.label+'\x3c/div\x3e\x3cdiv class\x3d"source-td source-tr-type textOverFlow" title\x3d"'+b+'"\x3e'+b+'\x3c/div\x3e\x3cdiv class\x3d"source-td source-tr-action"\x3e\x3cdiv class\x3d"edit hidden"\x3e\x3c/div\x3e\x3cdiv class\x3d"delete hidden"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mid-line"\x3e\x3c/div\x3e\x3c/div\x3e';b=c.toDom(b);var d=h(".source-tr",b)[0];d.source=a;c.place(b,this.sourcesList,"last");this._bindTrEvent(d)},_bindTrEvent:function(a){this.own(g(a,
["click",q,r],e.hitch(this,function(b){b.stopPropagation();var d=b.type;b=b.target||b.srcElement;var f=null;if("click"===d)c.hasClass(b,"edit")?(f=b.parentElement.parentElement,this._targetSourceId=f.source.id,this._editSourceTr(f)):c.hasClass(b,"delete")&&(f=b.parentElement.parentElement,this._targetSourceId=f.source.id,this._deleteSourceTr(f));else{var k=null,l=null;c.hasClass(b,"edit")?(k=b,f=k.parentElement.parentElement):c.hasClass(b,"delete")?(l=b,f=l.parentElement.parentElement):c.hasClass(b,
"source-tr")&&(f=b);if(k||l||f)"mouseover"===d?(c.removeClass(h(".source-td .edit",f)[0],"hidden"),c.removeClass(h(".source-td .delete",f)[0],"hidden")):"mouseout"===d&&(c.addClass(h(".source-td .edit",f)[0],"hidden"),c.addClass(h(".source-td .delete",f)[0],"hidden"))}})))},_editSourceTr:function(a){a=a.source;this._sourceType=a.type;var b={id:a.id,label:a.label,url:a.url,filter:a.filter,filterByExtent:a.filterByExtent,isDynamic:a.isDynamic,resultRecordType:a.resultRecordType,refreshInterval:a.refreshInterval,
dataSchema:a.dataSchema};"undefined"!==typeof a.resultRecordCount&&(b.resultRecordCount=a.resultRecordCount);"undefined"!==typeof a.portalUrl&&(b.portalUrl=a.portalUrl);"undefined"!==typeof a.itemId&&(b.itemId=a.itemId);this._createSourceConfigPopup(b)},_updateDataSourceOfAppConfig:function(a){a.id=this._targetSourceId;var b=e.clone(this.appConfig.dataSource),d;for(d in b.dataSources)d===this._targetSourceId&&(b.dataSources[d]=a);this._updateAppConfig(b)},_deleteSourceTr:function(){var a=new p({message:this.nls.removeSourceMessage,
buttons:[{label:this.nls.ok,onClick:e.hitch(this,function(){this._deleteDataSourceOfAppConfig();a.content=null;a.close()})},{label:this.nls.cancel,classNames:["jimu-btn-vacation"],onClick:e.hitch(this,function(){a.content=null;a.close()})}]})},_deleteDataSourceOfAppConfig:function(){var a=e.clone(this.appConfig.dataSource);delete a.dataSources[this._targetSourceId];this._updateAppConfig(a)},_updateDataSettingsOfAppConfig:function(){var a={},b=e.clone(this.appConfig.dataSource),d=this.refreshIntervalDijit.getValue();
"undefined"!==typeof d.minutes&&(a.unifiedRefreshInterval=d.minutes);b.settings=a;this._updateAppConfig(b)},_updateAppConfig:function(a){n.publish("dataSourceChanged",a)},_generateSourceId:function(){if(this._serviceType)return B.createDataSourceId(this._serviceType,this._layerId)},_setLayerId:function(a){a.layerInfo&&a.layerInfo.id&&(this._layerId=a.layerInfo.id)},_initEvent:function(){this.own(g(document.body,"click",e.hitch(this,function(){this._hiddenDsOption()})));this.own(g(this.refreshIntervalDijit,
"user-input-change",e.hitch(this,function(){this._isNotEmptySourceList()&&this._updateDataSettingsOfAppConfig()})));this.own(g(this.addNewDs,[q,r],e.hitch(this,function(a){a.stopPropagation();var b=a.type;h("div",this.addNewDs).forEach(function(d){c.hasClass(d,"img_add")?"mouseover"===b?c.addClass(d,"img_add_hover"):"mouseout"===b&&c.removeClass(d,"img_add_hover"):c.hasClass(d,"text_add")&&("mouseover"===b?c.addClass(d,"text_add_hover"):"mouseout"===b&&c.removeClass(d,"text_add_hover"))}.bind(this))})))},
_isNotEmptySourceList:function(){return 0<h(".source-tr",this.sourcesList).length},_isSupportStatistics:function(a){return a&&"object"===typeof a?a.advancedQueryCapabilities?!!a.advancedQueryCapabilities.supportsStatistics:!!a.supportsStatistics:!1},destroy:function(){this.refreshIntervalDijit&&this.refreshIntervalDijit.destroy();this.inherited(arguments)}})});